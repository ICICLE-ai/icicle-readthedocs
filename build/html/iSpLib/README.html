<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>iSpLib - An Intelligent Sparse Library &#8212; ICICLE-READTHEDOCS  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b3523f8e" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=cb25574f" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tapis Documentation" href="../tapis-project/README.html" />
    <link rel="prev" title="HARP - HPC Application Runtime Predictor" href="../harp/README.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="isplib-an-intelligent-sparse-library">
<h1>iSpLib - An Intelligent Sparse Library<a class="headerlink" href="#isplib-an-intelligent-sparse-library" title="Link to this heading">¶</a></h1>
<p>iSpLib is an accelerated sparse kernel library with PyTorch interface. This library has an auto-tuner which generates optimized custom sparse kernels based on the user environment. The goal of this library is to provide efficient sparse operations for Graph Neural Network implementations. Currently it has support for CPU-based efficient Sparse Dense Matrix Multiplication (spmm-sum only) with autograd.</p>
<p align="center"><img src="fusedmm-workflow.png" alt="iSpLib Workflow" width="60%"/></p>
<section id="system-requirements">
<h2>System Requirements<a class="headerlink" href="#system-requirements" title="Link to this heading">¶</a></h2>
<p>Users need to have the following software/tools installed in their PC/server. The source code was compiled and run successfully in Linux (Ubuntu and Centos distributions).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Make</span> <span class="o">&gt;=</span> <span class="mf">4.4</span>
<span class="n">GCC</span> <span class="o">&gt;=</span> <span class="mf">10.1</span> <span class="p">(</span><span class="n">Support</span> <span class="k">for</span> <span class="n">C</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">OpenMP</span> <span class="o">&gt;=</span> <span class="mf">4.5</span>
<span class="n">Python</span> <span class="o">&gt;=</span> <span class="mf">3.7</span>
<span class="n">NumPy</span> <span class="o">&gt;=</span> <span class="mf">1.21</span> <span class="p">(</span><span class="n">Or</span><span class="p">,</span> <span class="n">Anaconda</span> <span class="n">environment</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>To install the package, run the following commands:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/ICICLE-ai/iSpLib.git</span></code>: To clone this repository.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./configure</span></code>: To download and run the auto-tuner. This is a pre-requisite for the installation.</p></li>
<li><p>Create a virtualenv as the packages might conflict.</p></li>
<li><p>Install the dependencies <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">torch</span> <span class="pre">torchvision</span> <span class="pre">scikit-learn</span> <span class="pre">torch-scatter</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span></code>: To install the library.</p></li>
<li><p>Finally install custom version of torch-geometric <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">git+https://github.com/gamparohit/pytorch_geometric.git</span></code></p></li>
</ul>
</section>
<section id="troubleshoot">
<h2>Troubleshoot<a class="headerlink" href="#troubleshoot" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">make</span></code> command exits with unknown error message, try running <code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code> instead.</p></li>
<li><p>If you are having trouble installing torch-scatter, install it with -f flag and torch version.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import torch
print(torch.__version__)
!pip install torch-scatter -f https://data.pyg.org/whl/torch-{torch.__version__}.html
</pre></div>
</div>
</section>
<section id="convention-and-usage">
<h2>Convention and Usage<a class="headerlink" href="#convention-and-usage" title="Link to this heading">¶</a></h2>
<p>The current iSpLib has both regular and optimized SpMM operation for comparison purpose. The default operation is non-optimized. To use the optimized version, use the following code snippet for running the GNN model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">builtins</span>
<span class="n">builtins</span><span class="o">.</span><span class="n">FUSEDMM</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>FusedMM method is used as the optimized sparse kernel and it is generated when <code class="docutils literal notranslate"><span class="pre">./configure</span></code> command is run. See details here: <a class="reference external" href="https://arxiv.org/abs/2011.06391">FusedMM Method</a>.</p>
<p><strong>Note: If you are not using the optimized kernel, you will still have to explicitly mention <code class="docutils literal notranslate"><span class="pre">builtins.FUSEDMM</span> <span class="pre">=</span> <span class="pre">False</span></code> in the code, otherwise it will raise an error.</strong></p>
</section>
<section id="performance-and-testing">
<h2>Performance and Testing<a class="headerlink" href="#performance-and-testing" title="Link to this heading">¶</a></h2>
<p>When compared to PyTorch Sparse, a 2-layer GCN implemention with 10 epochs is typically-</p>
<ul class="simple">
<li><p><strong>2.5x</strong> faster on Cora dataset</p></li>
<li><p><strong>2x</strong> faster on Reddit dataset</p></li>
</ul>
<p>[Note: The speed-up varies largly depending on the system condition]</p>
<p>To run the test code, use the command: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code>. This runs the python script in <code class="docutils literal notranslate"><span class="pre">tests/GCN.py</span></code> and prints out the speed-up along with the accuracy. See <code class="docutils literal notranslate"><span class="pre">tests/Expected_GCN_output.txt</span></code> for reference.</p>
<section id="spmm-example">
<h3>SpMM Example<a class="headerlink" href="#spmm-example" title="Link to this heading">¶</a></h3>
<p>The SpMM operation can also be used directly to multiply two compatible matrices. Following is an example of a sparse and dense matrix multiplication:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">builtins</span>
<span class="kn">from</span> <span class="nn">isplib.matmul</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">isplib.tensor</span> <span class="kn">import</span> <span class="n">SparseTensor</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">coo_matrix</span>
<span class="kn">import</span> <span class="nn">torch</span> 

<span class="n">index</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">SparseTensor</span><span class="o">.</span><span class="n">from_scipy</span><span class="p">(</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">matrix</span>
<span class="n">builtins</span><span class="o">.</span><span class="n">FUSEDMM</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">print</span><span class="p">(</span><span class="n">spmm_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="license">
<h2>License<a class="headerlink" href="#license" title="Link to this heading">¶</a></h2>
<p>iSpLib is licensed under the https://opensource.org/licenses/BSD-3-Clause</p>
</section>
</section>
<section id="acknowledgements">
<h1>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Link to this heading">¶</a></h1>
<p><em>This work has been funded by grants from the National Science Foundation, including the ICICLE AI Institute (OAC 2112606)</em></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">ICICLE-READTHEDOCS</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">AI for CI-for-AI</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../harp/README.html">HARP - HPC Application Runtime Predictor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../harp/README.html#acknowledgements">Acknowledgements</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">iSpLib - An Intelligent Sparse Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="#acknowledgements">Acknowledgements</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software Architecture and Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tapis-project/README.html">Base ICICLE Tapis Software - Tapis is a hosted, web-based API framework for securely managing computational workloads across infrastructure and institutions so that experts can focus on their research instead of the technology.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event-engine/README.html">Event Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../event-engine/README.html#acknowledgement">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hello_icicle_auth_clients/README.html">Hello ICICLE Authentication Clients - Hello ICICLE Authentication consists of two command line interface (CLI) tools to authenticate with the Tapis Pods service. The first tool, ICICONSOLE, is specifically tailored to working with Neo4j databases hosted through the Tapis Pods. The second tool, TapisCL-ICICLE, allows the user to manage, operate, and interactively explore Tapis services.</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../harp/README.html" title="previous chapter">HARP - HPC Application Runtime Predictor</a></li>
      <li>Next: <a href="../tapis-project/README.html" title="next chapter">Tapis Documentation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, ICICLE.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/iSpLib/README.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>