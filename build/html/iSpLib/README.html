<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>iSpLib - An Intelligent Sparse Library &mdash; ICICLE-READTHEDOCS  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="https://aiinstitutes.org/wp-content/uploads/2022/07/icicle.jpeg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">AI for CI-for-AI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/ICICLE_Foodshed_Parser.html">Constrained Language Models Yield Few-Shot Semantic Parsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/PPOD_CA.html">PPOD_CA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/Region2vec.html">Region2vec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/Species-Classification-Multimodal-Context.html">Species Classification using Multimodal Heterogeneous Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/Store_Closure_Website.html">Store_Closure_Website (Version 1)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ICICLE-READTHEDOCS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">iSpLib - An Intelligent Sparse Library</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/iSpLib/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="isplib-an-intelligent-sparse-library">
<h1>iSpLib - An Intelligent Sparse Library<a class="headerlink" href="#isplib-an-intelligent-sparse-library" title="Link to this heading"></a></h1>
<p>iSpLib is an accelerated sparse kernel library with PyTorch interface. This library has an auto-tuner which generates optimized custom sparse kernels based on the user environment. The goal of this library is to provide efficient sparse operations for Graph Neural Network implementations. Currently it has support for CPU-based efficient Sparse Dense Matrix Multiplication (spmm-sum only) with autograd.</p>
<p align="center"><img src="fusedmm-workflow.png" alt="iSpLib Workflow" width="60%"/></p>
<section id="system-requirements">
<h2>System Requirements<a class="headerlink" href="#system-requirements" title="Link to this heading"></a></h2>
<p>Users need to have the following software/tools installed in their PC/server. The source code was compiled and run successfully in Linux (Ubuntu and Centos distributions).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Make</span> <span class="o">&gt;=</span> <span class="mf">4.4</span>
<span class="n">GCC</span> <span class="o">&gt;=</span> <span class="mf">10.1</span> <span class="p">(</span><span class="n">Support</span> <span class="k">for</span> <span class="n">C</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">OpenMP</span> <span class="o">&gt;=</span> <span class="mf">4.5</span>
<span class="n">Python</span> <span class="o">&gt;=</span> <span class="mf">3.7</span>
<span class="n">NumPy</span> <span class="o">&gt;=</span> <span class="mf">1.21</span> <span class="p">(</span><span class="n">Or</span><span class="p">,</span> <span class="n">Anaconda</span> <span class="n">environment</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<p>To install the package, run the following commands:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/ICICLE-ai/iSpLib.git</span></code>: To clone this repository.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./configure</span></code>: To download and run the auto-tuner. This is a pre-requisite for the installation.</p></li>
<li><p>Create a virtualenv as the packages might conflict.</p></li>
<li><p>Install the dependencies <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">torch</span> <span class="pre">torchvision</span> <span class="pre">scikit-learn</span> <span class="pre">torch-scatter</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span></code>: To install the library.</p></li>
<li><p>Finally install custom version of torch-geometric <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">git+https://github.com/gamparohit/pytorch_geometric.git</span></code></p></li>
</ul>
</section>
<section id="troubleshoot">
<h2>Troubleshoot<a class="headerlink" href="#troubleshoot" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">make</span></code> command exits with unknown error message, try running <code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code> instead.</p></li>
<li><p>If you are having trouble installing torch-scatter, install it with -f flag and torch version.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import torch
print(torch.__version__)
!pip install torch-scatter -f https://data.pyg.org/whl/torch-{torch.__version__}.html
</pre></div>
</div>
</section>
<section id="convention-and-usage">
<h2>Convention and Usage<a class="headerlink" href="#convention-and-usage" title="Link to this heading"></a></h2>
<p>The current iSpLib has both regular and optimized SpMM operation for comparison purpose. The default operation is non-optimized. To use the optimized version, use the following code snippet for running the GNN model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">builtins</span>
<span class="n">builtins</span><span class="o">.</span><span class="n">FUSEDMM</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>FusedMM method is used as the optimized sparse kernel and it is generated when <code class="docutils literal notranslate"><span class="pre">./configure</span></code> command is run. See details here: <a class="reference external" href="https://arxiv.org/abs/2011.06391">FusedMM Method</a>.</p>
<p><strong>Note: If you are not using the optimized kernel, you will still have to explicitly mention <code class="docutils literal notranslate"><span class="pre">builtins.FUSEDMM</span> <span class="pre">=</span> <span class="pre">False</span></code> in the code, otherwise it will raise an error.</strong></p>
</section>
<section id="performance-and-testing">
<h2>Performance and Testing<a class="headerlink" href="#performance-and-testing" title="Link to this heading"></a></h2>
<p>When compared to PyTorch Sparse, a 2-layer GCN implemention with 10 epochs is typically-</p>
<ul class="simple">
<li><p><strong>2.5x</strong> faster on Cora dataset</p></li>
<li><p><strong>2x</strong> faster on Reddit dataset</p></li>
</ul>
<p>[Note: The speed-up varies largly depending on the system condition]</p>
<p>To run the test code, use the command: <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code>. This runs the python script in <code class="docutils literal notranslate"><span class="pre">tests/GCN.py</span></code> and prints out the speed-up along with the accuracy. See <code class="docutils literal notranslate"><span class="pre">tests/Expected_GCN_output.txt</span></code> for reference.</p>
<section id="spmm-example">
<h3>SpMM Example<a class="headerlink" href="#spmm-example" title="Link to this heading"></a></h3>
<p>The SpMM operation can also be used directly to multiply two compatible matrices. Following is an example of a sparse and dense matrix multiplication:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">builtins</span>
<span class="kn">from</span> <span class="nn">isplib.matmul</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">isplib.tensor</span> <span class="kn">import</span> <span class="n">SparseTensor</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">coo_matrix</span>
<span class="kn">import</span> <span class="nn">torch</span> 

<span class="n">index</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">matrix</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">SparseTensor</span><span class="o">.</span><span class="n">from_scipy</span><span class="p">(</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">matrix</span>
<span class="n">builtins</span><span class="o">.</span><span class="n">FUSEDMM</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nb">print</span><span class="p">(</span><span class="n">spmm_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="license">
<h2>License<a class="headerlink" href="#license" title="Link to this heading"></a></h2>
<p>iSpLib is licensed under the https://opensource.org/licenses/BSD-3-Clause</p>
</section>
</section>
<section id="acknowledgements">
<h1>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Link to this heading"></a></h1>
<p><em>This work has been funded by grants from the National Science Foundation, including the ICICLE AI Institute (OAC 2112606)</em></p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ICICLE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>