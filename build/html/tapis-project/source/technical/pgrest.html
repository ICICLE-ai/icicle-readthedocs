<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PgREST &mdash; ICICLE-READTHEDOCS  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html">
            
              <img src="https://aiinstitutes.org/wp-content/uploads/2022/07/icicle.jpeg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">AI for CI-for-AI</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/ICICLE_Foodshed_Parser.html">Constrained Language Models Yield Few-Shot Semantic Parsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/PPOD_CA.html">PPOD_CA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Region2vec.html">Region2vec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Species-Classification-Multimodal-Context.html">Species Classification using Multimodal Heterogeneous Context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Species-Classification-Multimodal-Context.html#acknowledgements">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/Store_Closure_Website.html">Store_Closure_Website (Version 1)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ICICLE-READTHEDOCS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">PgREST</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/tapis-project/source/technical/pgrest.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pgrest">
<span id="target-pgrest"></span><h1>PgREST<a class="headerlink" href="#pgrest" title="Link to this heading"></a></h1>
<p>The PgREST service provides an HTTP-based API to a managed Postgres database. As with the other Tapis v3 service, PgREST
utilizes a REST architecture.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>There are two primary collections in the PgREST API. The Management API, provided at the URL <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage</span></code>,
includes endpoints for managing the collection of tables, views, stored procedures, and other objects defined in the
hosted Postgres database server. Each Tapis tenant has their own schema within PgREST’s managed Postrgres database
in which the tables and other objects are housed. When a table is created, endpoints are generated that allow users
to interact with the data within a table. These endpoints comprise the Data API, available at the URL <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data</span></code>.
Each collection, <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data/{collection}</span></code>, within the Data API corresponds to a table defined in the Management
API. The Data API is used to create, update, and read the rows within the corresponding tables.</p>
</section>
<section id="authentication-and-tooling">
<h2>Authentication and Tooling<a class="headerlink" href="#authentication-and-tooling" title="Link to this heading"></a></h2>
<p>PgREST currently recognizes Tapis v2 and v3 authentication tokens and uses these for determining access levels.
A valid Tapis v2 OAuth token should be passec to all requests to PgREST using the header <code class="docutils literal notranslate"><span class="pre">Tapis-v2-token</span></code>.
For example, using curl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Tapis-v2-token: 419465dg63h8e4782057degk20e3371&quot;</span><span class="w"> </span>https://tacc.tapis.io/v3/pgrest/manage/tables
</pre></div>
</div>
<p>Tapis v3 OAuth authentication tokens should be passed to all requests to PgREST using the header <code class="docutils literal notranslate"><span class="pre">X-Tapis-Token</span></code>.
For example, using curl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;X-Tapis-Token: TOKEN_HERE&quot;</span><span class="w"> </span>https://tacc.tapis.io/v3/pgrest/manage/tables
</pre></div>
</div>
<p>Additionally, PgREST should be accessible from the Tapis v3 Python SDK (tapipy) now with the addition of v3 authentication.</p>
</section>
<section id="permissions-and-roles">
<h2>Permissions and Roles<a class="headerlink" href="#permissions-and-roles" title="Link to this heading"></a></h2>
<p>PgREST currently implements a handful of basic, role-based permissions that leverage the Tapis v3 Security Kernel (SK).</p>
<section id="universal-roles">
<h3>Universal Roles<a class="headerlink" href="#universal-roles" title="Link to this heading"></a></h3>
<p>For now PgREST establishes the following five universal roles:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PGREST_ADMIN</span></code> – Grants user read and write access to all objects (e.g. tables, views, roles) in the
<code class="docutils literal notranslate"><span class="pre">/manage</span></code> API as well as read and write access to all associated data in the <code class="docutils literal notranslate"><span class="pre">/data</span></code> API.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PGREST_ROLE_ADMIN</span></code> – Grants user role creation and management access to roles in the <code class="docutils literal notranslate"><span class="pre">/manage/roles</span></code> API.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PGREST_WRITE</span></code> – Grants user read and write access to all associated data in the <code class="docutils literal notranslate"><span class="pre">/data</span></code> API.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PGREST_READ</span></code> – Grants user read access to all associated data in the <code class="docutils literal notranslate"><span class="pre">/data</span></code> API.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PGREST_USER</span></code> – Grants permission to user <code class="docutils literal notranslate"><span class="pre">/views</span></code> API. Each view has additional permission rules though.</p></li>
</ul>
<p>Without any of the above roles, a user will not have access to any PgREST endpoints.</p>
</section>
<section id="fine-tuned-role-access">
<h3>Fine-Tuned Role Access<a class="headerlink" href="#fine-tuned-role-access" title="Link to this heading"></a></h3>
<p>Along with the general access to endpoints when a user has a role of <code class="docutils literal notranslate"><span class="pre">PGREST_READ</span></code> or above, we have fine-tuned role
access to our get <cite>views</cite> endpoint.</p>
<p>Our get <cite>views</cite> endpoint requires only the <code class="docutils literal notranslate"><span class="pre">PGREST_USER</span></code> role. However each view itself when created (or modified) has a
<cite>permission_rules</cite> field. This field is a list of roles that the user must have in order to have access to that view. Thus
it is possible to divy out what information a user in the <code class="docutils literal notranslate"><span class="pre">PGREST_USER</span></code> role can get from views by restricting views with
roles created by the <code class="docutils literal notranslate"><span class="pre">/manage/roles</span></code> endpoint as a <code class="docutils literal notranslate"><span class="pre">PGREST_ADMIN</span></code> or <code class="docutils literal notranslate"><span class="pre">PGREST_ROLE_ADMIN</span></code>.</p>
</section>
<section id="tenant-awareness">
<h3>Tenant Awareness<a class="headerlink" href="#tenant-awareness" title="Link to this heading"></a></h3>
<p>Note that these roles are granted at the <em>tenant</em> level, so a user may be authorized at one level in one tenant and at a
different level (or not at all) in another tenant. In PgREST, the base URLs for a given tenant follow the pattern
<code class="docutils literal notranslate"><span class="pre">&lt;tenant_id&gt;.tapis.io</span></code>, just as they do for all other Tapis v3 services. Hence, this request:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>https://tacc.tapis.io/v3/pgrest/manage/tables
</pre></div>
</div>
<p>would list tables in the TACC tenant, while</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>https://cii.tapis.io/v3/pgrest/manage/tables
</pre></div>
</div>
<p>would list tables in the CII tenant.</p>
</section>
</section>
<section id="table-manage-api">
<h2>Table Manage API<a class="headerlink" href="#table-manage-api" title="Link to this heading"></a></h2>
<p>Table management is accomplished with the <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage/tables</span></code> endpoint. Creating a table amounts to
specifying the table name, the columns on the table, including the type of each column, and any additional validation
to be performed when storing data in the column, the root URL where the associated collection will be available within
the Data API, and, optionally, which HTTP verbs should not be available on the collection.</p>
<section id="table-creation-example">
<h3>Table Creation Example<a class="headerlink" href="#table-creation-example" title="Link to this heading"></a></h3>
<p>For example, suppose we wanted to manage a table of “widgets” with four columns. We could create a table by POSTing
the following JSON document to the <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage/tables</span></code> endpoint:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;table_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;widgets&quot;</span>,
<span class="w">  </span><span class="s2">&quot;root_url&quot;</span>:<span class="w"> </span><span class="s2">&quot;widgets&quot;</span>,
<span class="w">  </span><span class="s2">&quot;columns&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;varchar&quot;</span>,
<span class="w">      </span><span class="s2">&quot;char_len&quot;</span>:<span class="w"> </span><span class="m">255</span>,
<span class="w">      </span><span class="s2">&quot;unique&quot;</span>:<span class="w"> </span>true,
<span class="w">      </span><span class="s2">&quot;null&quot;</span>:<span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;widget_type&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;varchar&quot;</span>,
<span class="w">      </span><span class="s2">&quot;char_len&quot;</span>:<span class="w"> </span><span class="m">100</span>,
<span class="w">      </span><span class="s2">&quot;null&quot;</span>:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;integer&quot;</span>,
<span class="w">      </span><span class="s2">&quot;null&quot;</span>:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;is_private&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;boolean&quot;</span>,
<span class="w">      </span><span class="s2">&quot;null&quot;</span>:<span class="w"> </span><span class="s2">&quot;true&quot;</span>,
<span class="w">      </span><span class="s2">&quot;default&quot;</span>:<span class="w"> </span><span class="s2">&quot;true&quot;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The JSON describes a table with 4 columns, <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">widget_type</span></code>, <code class="docutils literal notranslate"><span class="pre">count</span></code>, and <code class="docutils literal notranslate"><span class="pre">is_private</span></code>. The fields within
the JSON object describing each column include its type, defined in the <code class="docutils literal notranslate"><span class="pre">data_type</span></code> attribute (and supporting
fields such as <code class="docutils literal notranslate"><span class="pre">char_len</span></code> for <code class="docutils literal notranslate"><span class="pre">varchar</span></code> columns), as well as optional constraints, such as the NOT NULL and
UNIQUE constraint, an optional <code class="docutils literal notranslate"><span class="pre">default</span></code> value, and an optional <code class="docutils literal notranslate"><span class="pre">primary_key</span></code> value. Only the <code class="docutils literal notranslate"><span class="pre">data_type</span></code> attribute is required.</p>
<p>To create this table and the corresponding <code class="docutils literal notranslate"><span class="pre">/data</span></code> API, we can use curl like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s2">&quot;@widgets.json&quot;</span><span class="w"> </span>https://dev.develop.tapis.io/v3/pgrest/manage/tables
</pre></div>
</div>
<p>If all works, the response should look something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;status&quot;</span>:<span class="w"> </span><span class="s2">&quot;success&quot;</span>,
<span class="w">  </span><span class="s2">&quot;message&quot;</span>:<span class="w"> </span><span class="s2">&quot;The request was successful.&quot;</span>,
<span class="w">  </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;dev&quot;</span>,
<span class="w">  </span><span class="s2">&quot;result&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;table_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;widgets&quot;</span>,
<span class="w">    </span><span class="s2">&quot;table_id&quot;</span>:<span class="w"> </span><span class="m">6</span>,
<span class="w">    </span><span class="s2">&quot;root_url&quot;</span>:<span class="w"> </span><span class="s2">&quot;widgets&quot;</span>,
<span class="w">    </span><span class="s2">&quot;endpoints&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">      </span><span class="s2">&quot;GET_ONE&quot;</span>,
<span class="w">      </span><span class="s2">&quot;GET_ALL&quot;</span>,
<span class="w">      </span><span class="s2">&quot;CREATE&quot;</span>,
<span class="w">      </span><span class="s2">&quot;UPDATE&quot;</span>,
<span class="w">      </span><span class="s2">&quot;DELETE&quot;</span>
<span class="w">    </span><span class="o">]</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Since the <code class="docutils literal notranslate"><span class="pre">root_url</span></code> attribute has value <code class="docutils literal notranslate"><span class="pre">widgets</span></code>, an associated collection at URL <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data/widgets</span></code>
is automatically made available for managing and retrieving the data (rows) on the table. See the <a class="reference internal" href="#target-data-api"><span class="std std-ref">Data API</span></a> section
below for more details.</p>
</section>
<section id="table-definition-rules">
<h3>Table Definition Rules<a class="headerlink" href="#table-definition-rules" title="Link to this heading"></a></h3>
<p>This is a complete list of constraints and properties a table can have in it’s table definition. Each table definition has a host of
fields, with the column field have a host of options to delegate how to create the postgres column.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">table_name</span></code> - <strong>required</strong></p>
<ul>
<li><p>The name of the table in question.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">root_url</span></code></p>
<ul>
<li><p>The root_url for PgRESTs /data endpoint.</p></li>
<li><p>Ex: root_url “table25” would be accessible via “<a class="reference external" href="http://pgrestURL/data/table25">http://pgrestURL/data/table25</a>”.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">enums</span></code></p>
<ul>
<li><p>Enum generation is done in table definitions.</p></li>
<li><p>Provide a dict of enums where the key is enum name and the value is the possible values for the enum.</p></li>
<li><p>Ex: <code class="docutils literal notranslate"><span class="pre">{&quot;accountrole&quot;:</span> <span class="pre">[&quot;ADMIN&quot;,</span> <span class="pre">&quot;USER&quot;]}</span></code></p>
<ul>
<li><p>Creates an “accountrole” enum that can have values of “ADMIN” or “USER”</p></li>
</ul>
</li>
<li><p>Deletion/Updates are not currently supported. Speak to developer if you’re interested in a delete/update endpoint.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">comments</span></code></p>
<ul>
<li><p>Field to allow for better readability of table json. Table comments are saved and outputted on /manage/tables/ endpoints.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">constraints</span></code></p>
<ul>
<li><p>Specification of Postgres table constraints. Currently only allows multi-column unique constraints</p></li>
<li><p>Constraints available:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">unique</span></code></p>
<ul>
<li><p>multi-column unique constraint that requires sets of column values to be unique.</p></li>
<li><p>Note: Unique constraint must have unique naming between tables. Constraints cannot be used more than once.</p></li>
<li><p>Ex: <code class="docutils literal notranslate"><span class="pre">&quot;constraints&quot;:</span> <span class="pre">{&quot;unique&quot;:</span> <span class="pre">{&quot;two_col_pair&quot;:</span> <span class="pre">[&quot;col_one&quot;,</span> <span class="pre">&quot;col_two&quot;]}}</span></code></p>
<ul>
<li><p>This means that col_one and col_two cannot have pairs of values that are identical.</p></li>
<li><p>The constraint name can be specified as well</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns</span></code> - <strong>required</strong></p>
<ul>
<li><p>Column definitions in the form of a dict. Dict key would be column, value would be column definition.</p></li>
<li><p>Ex: <code class="docutils literal notranslate"><span class="pre">{&quot;username&quot;:</span> <span class="pre">{&quot;unique&quot;:</span> <span class="pre">true,</span> <span class="pre">&quot;data_type&quot;:</span> <span class="pre">&quot;varchar&quot;,</span> <span class="pre">&quot;char_len&quot;:</span> <span class="pre">255}</span></code></p></li>
<li><p>Columns arguments are as follows.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">data_type</span></code> - <strong>required</strong></p>
<ul>
<li><p>Specifies the data type for values in this column.</p></li>
<li><p>Case insensitive.</p></li>
<li><p>Can be varchar, datetime, {enumName}, text, timestamp, serial, varchar[], boolean, integer, integer[].</p>
<ul>
<li><p>Note: varchar requires the char_len column definition.</p></li>
<li><p>Note: Setting a timestamp data_type column default to <code class="docutils literal notranslate"><span class="pre">UPDATETIME</span></code> or <code class="docutils literal notranslate"><span class="pre">CREATETIME</span></code> has special properties.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CREATETIME</span></code> sets the field to the UTC time at creation. It is then not changed later.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UPDATETIME</span></code> sets the filed to the UTC time at creation. It is updated to the update time when it is updated.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Serial Data type</p>
<ul>
<li><p>Not actually a serial data type. On the postgres side this is <code class="docutils literal notranslate"><span class="pre">INTEGER</span> <span class="pre">GENERATED</span> <span class="pre">BY</span> <span class="pre">DEFAULT</span> <span class="pre">AS</span> <span class="pre">IDENTITY</span> <span class="pre">(START</span> <span class="pre">WITH</span> <span class="pre">{serial_start}</span> <span class="pre">INCREMENT</span> <span class="pre">BY</span> <span class="pre">{serial_increment})</span></code></p></li>
<li><p>This is to get around the fact that the serial data type isn’t that well received by Postgres</p></li>
<li><p>This also means that users can specify <code class="docutils literal notranslate"><span class="pre">serial_start</span></code> and <code class="docutils literal notranslate"><span class="pre">serial_increment</span></code> to adjust how it works.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">char_len</span></code></p>
<ul>
<li><p>Additional argument for varchar data_types. Required to set max value size.</p></li>
<li><p>Can be any value from 1 to 255.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">serial_start</span></code></p>
<ul>
<li><p>Additional argument for serial data_types. Defaults to 1.</p></li>
<li><p>Integer that specifies the start of a SQL sequence.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">serial_increment</span></code></p>
<ul>
<li><p>Additional argument for serial data_types. Defaults to 1.</p></li>
<li><p>Integer that specifies the increment to use for serial data_types. Integer.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unique</span></code></p>
<ul>
<li><p>Determines whether or not each value in this column is unique.</p></li>
<li><p>Can be true or false.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">null</span></code></p>
<ul>
<li><p>States whether or not a value can be “null”.</p></li>
<li><p>Can be true or false.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">comments</span></code></p>
<ul>
<li><p>Field to allow for better readability of table and column json. Column comments are not saved or used. They are for json readability only.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code></p>
<ul>
<li><p>Sets default value for column to fallback on if no value is given.</p></li>
<li><p>Case insensitive.</p></li>
<li><p>Must follow the data_type for the column.</p></li>
<li><p>Note: Setting a timestamp data_type column default to <code class="docutils literal notranslate"><span class="pre">UPDATETIME</span></code> or <code class="docutils literal notranslate"><span class="pre">CREATETIME</span></code> has special properties.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CREATETIME</span></code> sets the field to the UTC time at creation. It is then not changed later.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UPDATETIME</span></code> sets the filed to the UTC time at creation. It is updated to the update time when it is updated.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">primary_key</span></code></p>
<ul>
<li><p>Specifies primary_key for the table.</p></li>
<li><p>This can only be used for one column in the table.</p></li>
<li><p>This primary_key column will be the value users can use to get a row in the table, <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data/my_pk</span></code>.</p></li>
<li><p>If this is not specified in a table, primary_key defaults to “{table_name}_id”.
* Note that this default cannot be modified and is of data_type=serial.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">foreign_key</span></code></p>
<ul>
<li><p>Weather or not this key should reference a key in another table, a “foreign key”.</p></li>
<li><p>Can be true or false.</p></li>
<li><p>If foreign_key is set to true, columns arguments <code class="docutils literal notranslate"><span class="pre">reference_table</span></code>, <code class="docutils literal notranslate"><span class="pre">reference_column</span></code>, and <code class="docutils literal notranslate"><span class="pre">on_delete</span></code> must also be set.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_table</span></code></p>
<ul>
<li><p>Only needed in the case that foreign_key is set to true.</p></li>
<li><p>Specifies the foreign table that the foreign_key is in.</p></li>
<li><p>Can be set to the table_name of any table.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">reference_column</span></code></p>
<ul>
<li><p>Only needed in the case that foreign_key is set to true.</p></li>
<li><p>Specifies the foreign column that the foreign_key is in.</p></li>
<li><p>Can be set to the key for any column in the reference_table.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">on_event</span></code></p>
<ul>
<li><p>Only needed in the case that foreign_key is set to true.</p></li>
<li><p>Case insensitive.</p></li>
<li><p>Specifies the event strategy when referencing a foreign key.</p></li>
<li><p>Can be set to an event of <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">DELETE</span></code> or <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">UPDATE</span></code>, if the key gets deleted or updated, the <code class="docutils literal notranslate"><span class="pre">event_action</span></code> will be completed by postgres</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">DELETE</span></code> Sets off event_action if reference is deleted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">UPDATE</span></code> Sets off event_action if reference is updated.</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">event_action</span></code></p>
<ul>
<li><p>Only needed in the case that foreign_key is set to true.</p></li>
<li><p>Case insensitive.</p></li>
<li><p>Specifies the event action to complete when a reference gets the <code class="docutils literal notranslate"><span class="pre">on_event</span></code> event.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CASCADE</span></code> deletes or updates this column when <code class="docutils literal notranslate"><span class="pre">on_event</span></code> occurs to reference.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">NULL</span></code> set this column to null when <code class="docutils literal notranslate"><span class="pre">on_event</span></code> occurs to reference.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">DEFAULT</span></code> set this column to column default when <code class="docutils literal notranslate"><span class="pre">on_event</span></code> occurs to reference.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RESTRICT</span></code> prevents deletion/update of a row when <code class="docutils literal notranslate"><span class="pre">on_event</span></code> occurs to reference.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NO</span> <span class="pre">ACTION</span></code> does nothing, raises error when referenced, when <code class="docutils literal notranslate"><span class="pre">on_event</span></code> occurs to reference.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="retrieving-table-descriptions">
<h3>Retrieving Table Descriptions<a class="headerlink" href="#retrieving-table-descriptions" title="Link to this heading"></a></h3>
<p>You can list all tables you have access to by making a GET request to <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage/tables</span></code>. For example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$tok</span><span class="s2">&quot;</span><span class="w"> </span>https://dev.tapis.io/v3/pgrest/manage/tables
</pre></div>
</div>
<p>returns a result like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>
<span class="w">   </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;table_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;initial_table&quot;</span>,
<span class="w">      </span><span class="s2">&quot;table_id&quot;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">      </span><span class="s2">&quot;root_url&quot;</span>:<span class="w"> </span><span class="s2">&quot;init&quot;</span>,
<span class="w">      </span><span class="s2">&quot;tenant&quot;</span>:<span class="w"> </span><span class="s2">&quot;dev&quot;</span>,
<span class="w">      </span><span class="s2">&quot;endpoints&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;GET_ONE&quot;</span>,
<span class="w">        </span><span class="s2">&quot;GET_ALL&quot;</span>,
<span class="w">        </span><span class="s2">&quot;CREATE&quot;</span>,
<span class="w">        </span><span class="s2">&quot;UPDATE&quot;</span>,
<span class="w">        </span><span class="s2">&quot;DELETE&quot;</span>
<span class="w">      </span><span class="o">]</span>,
<span class="w">      </span><span class="s2">&quot;tenant_id&quot;</span>:<span class="w"> </span><span class="s2">&quot;dev&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;table_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;widgets&quot;</span>,
<span class="w">      </span><span class="s2">&quot;table_id&quot;</span>:<span class="w"> </span><span class="m">6</span>,
<span class="w">      </span><span class="s2">&quot;root_url&quot;</span>:<span class="w"> </span><span class="s2">&quot;widgets&quot;</span>,
<span class="w">      </span><span class="s2">&quot;tenant&quot;</span>:<span class="w"> </span><span class="s2">&quot;dev&quot;</span>,
<span class="w">      </span><span class="s2">&quot;endpoints&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;GET_ONE&quot;</span>,
<span class="w">        </span><span class="s2">&quot;GET_ALL&quot;</span>,
<span class="w">        </span><span class="s2">&quot;CREATE&quot;</span>,
<span class="w">        </span><span class="s2">&quot;UPDATE&quot;</span>,
<span class="w">        </span><span class="s2">&quot;DELETE&quot;</span>
<span class="w">      </span><span class="o">]</span>,
<span class="w">      </span><span class="s2">&quot;tenant_id&quot;</span>:<span class="w"> </span><span class="s2">&quot;dev&quot;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">]</span>
</pre></div>
</div>
<p>We can also retrieve a single table by <code class="docutils literal notranslate"><span class="pre">id</span></code>. For example</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$tok</span><span class="s2">&quot;</span><span class="w"> </span>https://dev.tapis.io/v3/pgrest/manage/tables/6

<span class="w">  </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;table_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;widgets&quot;</span>,
<span class="w">      </span><span class="s2">&quot;table_id&quot;</span>:<span class="w"> </span><span class="m">6</span>,
<span class="w">      </span><span class="s2">&quot;root_url&quot;</span>:<span class="w"> </span><span class="s2">&quot;widgets&quot;</span>,
<span class="w">      </span><span class="s2">&quot;endpoints&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;GET_ONE&quot;</span>,
<span class="w">        </span><span class="s2">&quot;GET_ALL&quot;</span>,
<span class="w">        </span><span class="s2">&quot;CREATE&quot;</span>,
<span class="w">        </span><span class="s2">&quot;UPDATE&quot;</span>,
<span class="w">        </span><span class="s2">&quot;DELETE&quot;</span>
<span class="w">      </span><span class="o">]</span>,
<span class="w">      </span><span class="s2">&quot;tenant_id&quot;</span>:<span class="w"> </span><span class="s2">&quot;dev&quot;</span>
<span class="w">  </span><span class="o">}</span>
</pre></div>
</div>
<p>We can also pass <code class="docutils literal notranslate"><span class="pre">details=true</span></code> query parameter to see the column definitions and validation schema for a particular
table. This can be useful to understand exactly what’s happening. The call would be as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$tok</span><span class="s2">&quot;</span><span class="w"> </span>https://dev.tapis.io/v3/pgrest/manage/tables/6?details<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
</section>
<section id="example-of-complex-table">
<h3>Example of Complex Table<a class="headerlink" href="#example-of-complex-table" title="Link to this heading"></a></h3>
<p>The following is a working complex table definition using all parameters for user reference.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;table_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;UserProfile&quot;</span>,
<span class="w">  </span><span class="s2">&quot;root_url&quot;</span>:<span class="w"> </span><span class="s2">&quot;user-profile&quot;</span>,
<span class="w">  </span><span class="s2">&quot;delete&quot;</span>:<span class="w"> </span>false,
<span class="w">  </span><span class="s2">&quot;enums&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;accountrole&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;ADMIN&quot;</span>,
<span class="w">                            </span><span class="s2">&quot;USER&quot;</span>,
<span class="w">                            </span><span class="s2">&quot;GUEST&quot;</span><span class="o">]}</span>,
<span class="w">  </span><span class="s2">&quot;comments&quot;</span>:<span class="w"> </span><span class="s2">&quot;This is the user profile table that keeps track of user profiles and data&quot;</span>,
<span class="w">  </span><span class="s2">&quot;constraints&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;unique&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="s2">&quot;unique_first_name_last_name_pair&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;first_name&quot;</span>,<span class="w"> </span><span class="s2">&quot;last_name&quot;</span><span class="o">]}}</span>,
<span class="w">  </span><span class="s2">&quot;columns&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;user_profile_id&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;serial&quot;</span>,
<span class="w">      </span><span class="s2">&quot;serial_start&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">      </span><span class="s2">&quot;serial_increment&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">      </span><span class="s2">&quot;primary_key&quot;</span>:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;username&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;unique&quot;</span>:<span class="w"> </span>true,
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;varchar&quot;</span>,
<span class="w">      </span><span class="s2">&quot;char_len&quot;</span>:<span class="w"> </span><span class="m">255</span>
<span class="w">      </span><span class="s2">&quot;comments&quot;</span>:<span class="w"> </span><span class="s2">&quot;The username used by *** service&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;role&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;accountrole&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;company&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;varchar&quot;</span>,
<span class="w">      </span><span class="s2">&quot;char_len&quot;</span>:<span class="w"> </span><span class="m">255</span>,
<span class="w">      </span><span class="s2">&quot;foreign_key&quot;</span>:<span class="w"> </span>true,
<span class="w">      </span><span class="s2">&quot;reference_table&quot;</span>:<span class="w"> </span><span class="s2">&quot;Companys&quot;</span>,
<span class="w">      </span><span class="s2">&quot;reference_column&quot;</span>:<span class="w"> </span><span class="s2">&quot;company_name&quot;</span>,
<span class="w">      </span><span class="s2">&quot;on_event&quot;</span>:<span class="w"> </span><span class="s2">&quot;ON UPDATE&quot;</span>,
<span class="w">      </span><span class="s2">&quot;event_action&quot;</span>:<span class="w"> </span><span class="s2">&quot;cascade&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;employee_id&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;integer&quot;</span>,
<span class="w">      </span><span class="s2">&quot;foreign_key&quot;</span>:<span class="w"> </span>true,
<span class="w">      </span><span class="s2">&quot;reference_table&quot;</span>:<span class="w"> </span><span class="s2">&quot;Employees&quot;</span>,
<span class="w">      </span><span class="s2">&quot;reference_column&quot;</span>:<span class="w"> </span><span class="s2">&quot;employee_id&quot;</span>,
<span class="w">      </span><span class="s2">&quot;on_event&quot;</span>:<span class="w"> </span><span class="s2">&quot;on delete&quot;</span>,
<span class="w">      </span><span class="s2">&quot;event_action&quot;</span>:<span class="w"> </span><span class="s2">&quot;RESTRICT&quot;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="s2">&quot;first_name&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;null&quot;</span>:<span class="w"> </span>true,
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;varchar&quot;</span>,
<span class="w">      </span><span class="s2">&quot;char_len&quot;</span>:<span class="w"> </span><span class="m">255</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;last_name&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;null&quot;</span>:<span class="w"> </span>true,
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;varchar&quot;</span>,
<span class="w">      </span><span class="s2">&quot;char_len&quot;</span>:<span class="w"> </span><span class="m">255</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;created_at&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;timestamp&quot;</span>,
<span class="w">      </span><span class="s2">&quot;default&quot;</span>:<span class="w"> </span><span class="s2">&quot;CREATETIME&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;last_updated_at&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;data_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;timestamp&quot;</span>,
<span class="w">      </span><span class="s2">&quot;default&quot;</span>:<span class="w"> </span><span class="s2">&quot;UPDATETIME&quot;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="editing-tables">
<h3>Editing tables<a class="headerlink" href="#editing-tables" title="Link to this heading"></a></h3>
<p>Tenant admins are able to modify tables with a few select operations by making a PUT request to
<code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage/tables/{table_id}</span></code>. This feature is only available to admins, please contact a
service admin in order to see if you qualify for the role.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Support for editing tables for tenant admins was added in version 1.1.0.</p>
</div>
<p>This PUT endpoint effectively uses <code class="docutils literal notranslate"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> commands with postgres and also updates the Django
database backend to match these changes. Due to the complexity in this workflow, admins are only allowed
a fixed set of operations to use. Additionally, only one operation is allowed to take place per PUT
request. For example, admins can not edit a table’s name, and drop a column in the same request.</p>
<p>The endpoint’s error messages are generally verbose, so errors should be pointed out poignantly. A
list of all PUT operations available and examples is as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">root_url</span></code></p>
<ul>
<li><p>Operation to change the root_url currently associated with the table.</p></li>
<li><p>Ex. Change table with root_url <code class="docutils literal notranslate"><span class="pre">all_people</span></code> to <code class="docutils literal notranslate"><span class="pre">some_people</span></code>.</p>
<ul>
<li><p>Payload is <code class="docutils literal notranslate"><span class="pre">{&quot;root_url&quot;:</span> <span class="pre">&quot;some_people&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">table_name</span></code></p>
<ul>
<li><p>Operation to change the table_name currently associated with the table.</p></li>
<li><p>Ex: Change table with table_name <code class="docutils literal notranslate"><span class="pre">all_people</span></code> to <code class="docutils literal notranslate"><span class="pre">some_people</span></code>.</p>
<ul>
<li><p>Payload is <code class="docutils literal notranslate"><span class="pre">{&quot;table_name&quot;:</span> <span class="pre">&quot;some_people&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">comments</span></code></p>
<ul>
<li><p>Operation to change the comments currently associated with the table (Overwrites existing).</p></li>
<li><p>Ex: Adding “This column is not case-sensitive” comment to table with table_id <code class="docutils literal notranslate"><span class="pre">84</span></code>.</p>
<ul>
<li><p>Payload is <code class="docutils literal notranslate"><span class="pre">{&quot;comments&quot;:</span> <span class="pre">&quot;This</span> <span class="pre">column</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">case-sensitive&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">endpoints</span></code></p>
<ul>
<li><p>Operation to change the endpoints a table currently has available.</p></li>
<li><p>Endpoints available are “ALL” (alias to set all endpoints to available), “NONE” (alias to set no endpoints), “GET_ALL”, “GET_ONE”, “CREATE”, “UPDATE”, and “DELETE”.</p></li>
<li><p>Ex: Changing table so all endpoints are available.</p>
<ul>
<li><p>Payload is <code class="docutils literal notranslate"><span class="pre">{&quot;endpoints&quot;:</span> <span class="pre">[&quot;ALL&quot;]}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">column_type</span></code></p>
<ul>
<li><p>Operation to change the column_type of a particular column in table.</p></li>
<li><p>column_types available are “varchar”, “boolean”, “integer”, “text”, “timestamp”, “serial”, and “datetime”.</p></li>
<li><p>Ex: Changing column <code class="docutils literal notranslate"><span class="pre">names</span></code> from type <code class="docutils literal notranslate"><span class="pre">integer</span></code> to <code class="docutils literal notranslate"><span class="pre">varchar</span></code>.</p>
<ul>
<li><p>Payload is <code class="docutils literal notranslate"><span class="pre">{&quot;column_type&quot;:</span> <span class="pre">&quot;names,</span> <span class="pre">varchar&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">add_column</span></code></p>
<ul>
<li><p>Operation to add a column to a table.</p></li>
<li><p>Uses the same column definition formatting as when creating a table. All data types and parameters apply.</p></li>
<li><p>Ex: Adding column <code class="docutils literal notranslate"><span class="pre">names</span></code>.</p>
<ul>
<li><p>Payload is <code class="docutils literal notranslate"><span class="pre">{&quot;add_column&quot;:</span> <span class="pre">{&quot;names&quot;:</span> <span class="pre">{&quot;data_type&quot;:</span> <span class="pre">&quot;varchar&quot;,</span> <span class="pre">&quot;char_len&quot;:</span> <span class="pre">255,</span> <span class="pre">&quot;comments&quot;:</span> <span class="pre">&quot;first</span> <span class="pre">name&quot;}}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">drop_column</span></code></p>
<ul>
<li><p>Operation to drop a column in a table (Not reversible).</p></li>
<li><p>Ex: Dropping column <code class="docutils literal notranslate"><span class="pre">useless_archive_column</span></code>.</p>
<ul>
<li><p>Payload is <code class="docutils literal notranslate"><span class="pre">{&quot;drop_column&quot;:</span> <span class="pre">&quot;useless_archive_column&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">drop_default</span></code></p>
<ul>
<li><p>Operation to drop a default currently set on a column in a table.</p></li>
<li><p>Ex: Dropping default for column <code class="docutils literal notranslate"><span class="pre">i_no_longer_need_a_default</span></code>.</p>
<ul>
<li><p>Payload is <code class="docutils literal notranslate"><span class="pre">{&quot;drop_default&quot;:</span> <span class="pre">&quot;i_no_longer_need_a_default&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_default</span></code></p>
<ul>
<li><p>Operation to set a new default on a column in a table.</p></li>
<li><p>Ex: Setting default on column <code class="docutils literal notranslate"><span class="pre">names</span></code> to <code class="docutils literal notranslate"><span class="pre">no_name</span></code>.</p>
<ul>
<li><p>Payload is <code class="docutils literal notranslate"><span class="pre">{&quot;set_default&quot;:</span> <span class="pre">&quot;names,no_name&quot;}</span></code></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>For example, to change the table_name of table with table_id <code class="docutils literal notranslate"><span class="pre">3</span></code> to <code class="docutils literal notranslate"><span class="pre">my_new_name</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$tok</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-d<span class="w"> </span><span class="s2">&quot;{&#39;table_name&#39;: &#39;my_new_name&#39;}&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>https://dev.tapis.io/v3/pgrest/manage/tables/3
</pre></div>
</div>
<p>For example, to change the column_type of column <code class="docutils literal notranslate"><span class="pre">names</span></code> from <code class="docutils literal notranslate"><span class="pre">integer</span></code> to <code class="docutils literal notranslate"><span class="pre">varchar</span></code> in the same table:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$tok</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-d<span class="w"> </span><span class="s2">&quot;{&#39;column_type&#39;: &#39;names, varchar&#39;}&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>https://dev.tapis.io/v3/pgrest/manage/tables/3
</pre></div>
</div>
<p>For example, to change the endpoints of table <code class="docutils literal notranslate"><span class="pre">3</span></code> to only <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> and <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$tok</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-d<span class="w"> </span><span class="s2">&quot;{&#39;endpoints&#39;: \&#39;[&#39;CREATE&#39;, &#39;DELETE&#39;]\&#39;}&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>https://dev.tapis.io/v3/pgrest/manage/tables/3
</pre></div>
</div>
<p>All operations will result in either a verbose error message from the API regarding issues,
the postgres error message returned to the API in cases of a postgres error, or a
<code class="docutils literal notranslate"><span class="pre">Table</span> <span class="pre">put</span> <span class="pre">successfully</span></code> message.</p>
</section>
</section>
<section id="table-user-api">
<span id="target-data-api"></span><h2>Table User API<a class="headerlink" href="#table-user-api" title="Link to this heading"></a></h2>
<p>The Data API provides endpoints for managing and retrieving data (rows) stored on tables defined through the Management
API. For each table defined through the Management API, there is a corresponding endpoint within the Data API with URL
<code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data/{root_url}</span></code>, where <code class="docutils literal notranslate"><span class="pre">{root_url}</span></code> is the associated attribute on the table.</p>
<p>Continuing with our widgets table from above, the associated endpoint within the Data API would have URL
<code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data/widgets</span></code> because the <code class="docutils literal notranslate"><span class="pre">root_url</span></code> property of the widgets table was defined to be <code class="docutils literal notranslate"><span class="pre">widgets</span></code>.
Moreover, all 5 default endpoints on the <code class="docutils literal notranslate"><span class="pre">widgets</span></code> collection are available (none were explicitly restricted when
registering the table). The endpoints within the <code class="docutils literal notranslate"><span class="pre">widgets</span></code> can be described as follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>GET</p></th>
<th class="head"><p>POST</p></th>
<th class="head"><p>PUT</p></th>
<th class="head"><p>DELETE</p></th>
<th class="head"><p>Endpoint</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>X</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td></td>
<td><p>/v3/pgrest/data/widgets</p></td>
<td><p>List/create widgets; bulk update
multiple widgets.</p></td>
</tr>
<tr class="row-odd"><td><p>X</p></td>
<td></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>/v3/pgrest/data/widgets/{id}</p></td>
<td><p>Get/update/delete a widget by
id.</p></td>
</tr>
</tbody>
</table>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">id</span></code> column is used for referencing a specific row. Currently, PgREST generates this column
automatically for each table and calls it <cite>{table_name}_id</cite>. It is a sql serial data type. To override this
generic <code class="docutils literal notranslate"><span class="pre">id</span></code> column, you may assign a key of your choice the <code class="docutils literal notranslate"><span class="pre">primary_key</span></code> constraint. We’ll then use the
values in this field to get a specified rows. <code class="docutils literal notranslate"><span class="pre">primary_key</span></code> columns, must be integers or varchars which are
not null and unique.</p>
<p>Additionally, to find the <code class="docutils literal notranslate"><span class="pre">id</span></code> to use for your row, the data endpoints return a <code class="docutils literal notranslate"><span class="pre">_pkid</span></code> field in the results
for each row for ease of use. <code class="docutils literal notranslate"><span class="pre">_pkid</span></code> is not currently kept in the database, but is added to the result object
between retrieving the database result and returning the result to the user. As such, <code class="docutils literal notranslate"><span class="pre">where</span></code> queries will NOT
work on the <code class="docutils literal notranslate"><span class="pre">_pkid</span></code> field.</p>
<section id="creating-a-row">
<h3>Creating a Row<a class="headerlink" href="#creating-a-row" title="Link to this heading"></a></h3>
<p>Sending a POST request to the <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data/{root_url}</span></code> URL will create a new row on the corresponding table. The
POST message body should be a JSON document providing values for each of the columns inside a single <code class="docutils literal notranslate"><span class="pre">data</span></code> object.
The values will first be validated with the json schema generated from the columns data sent in on table creation. This
will enforce data types, max lengths, and required fields. The row is then added to the table using pure SQL format
and is fully ATOMIC.</p>
<p>For example, the following JSON body could be used to create a new row on the widgets example table:</p>
<p>new_row.json:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;data&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;example-widget&quot;</span>,
<span class="w">      </span><span class="s2">&quot;widget_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;gear&quot;</span>,
<span class="w">      </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">0</span>,
<span class="w">      </span><span class="s2">&quot;is_private&quot;</span>:<span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The following curl command would create a row defined by the JSON document above</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;@new_row.json&quot;</span><span class="w"> </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/data/widgets
</pre></div>
</div>
<p>if all goes well, the response should look like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;status&quot;</span>:<span class="w"> </span><span class="s2">&quot;success&quot;</span>,
<span class="w">  </span><span class="s2">&quot;message&quot;</span>:<span class="w"> </span><span class="s2">&quot;The request was successful.&quot;</span>,
<span class="w">  </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;dev&quot;</span>,
<span class="w">  </span><span class="s2">&quot;result&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;widgets_id&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">      </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;example-widget&quot;</span>,
<span class="w">      </span><span class="s2">&quot;widget_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;gear&quot;</span>,
<span class="w">      </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">0</span>,
<span class="w">      </span><span class="s2">&quot;is_private&quot;</span>:<span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Note that an <code class="docutils literal notranslate"><span class="pre">id</span></code> of <code class="docutils literal notranslate"><span class="pre">1</span></code> was generated for the new record.</p>
</section>
<section id="creating-multiple-rows-at-once">
<h3>Creating multiple rows at once<a class="headerlink" href="#creating-multiple-rows-at-once" title="Link to this heading"></a></h3>
<p>The same as creating a single row, POST requests to the``/v3/pgrest/data/{root_url}`` URL containing lists of row definitions
will create rows in bulk. POST message body should be a JSON list contain JSON documents providing values for each of the
columns inside a single <code class="docutils literal notranslate"><span class="pre">data</span></code> object. This works exactly the same way as single row creation, but with a list input.
The rows are then added to the table using pure SQL format and is fully ATOMIC.</p>
<p>For example, the following JSON body could be used to create three rows on the widgets example table:</p>
<p>new_rows.json:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;data&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;example-widget1&quot;</span>,
<span class="w">      </span><span class="s2">&quot;widget_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;gear1&quot;</span>,
<span class="w">      </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">0</span>,
<span class="w">      </span><span class="s2">&quot;is_private&quot;</span>:<span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;example-widget2&quot;</span>,
<span class="w">      </span><span class="s2">&quot;widget_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;gear2&quot;</span>,
<span class="w">      </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">0</span>,
<span class="w">      </span><span class="s2">&quot;is_private&quot;</span>:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;example-widget3&quot;</span>,
<span class="w">      </span><span class="s2">&quot;widget_type&quot;</span>:<span class="w"> </span><span class="s2">&quot;gear3&quot;</span>,
<span class="w">      </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">0</span>,
<span class="w">      </span><span class="s2">&quot;is_private&quot;</span>:<span class="w"> </span><span class="nb">false</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The following curl command would create a row defined by the JSON document above</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;@new_rows.json&quot;</span><span class="w"> </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/data/widgets
</pre></div>
</div>
<p>if all goes well, the response should return all the rows just created.</p>
</section>
<section id="updating-a-row">
<h3>Updating a Row<a class="headerlink" href="#updating-a-row" title="Link to this heading"></a></h3>
<p>Sending a PUT request to the <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data/{root_url}/{id}</span></code> URL will update an existing row on the corresponding
table. The request message body should be a JSON document providing the columns to be updates and the new values. For
example, the following would update the <code class="docutils literal notranslate"><span class="pre">example-widget</span></code> created above:</p>
<p>update_row.json</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;data&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The following curl command would update the <code class="docutils literal notranslate"><span class="pre">example-widget</span></code> row (with <code class="docutils literal notranslate"><span class="pre">id</span></code> of <code class="docutils literal notranslate"><span class="pre">i</span></code>) using the JSON document above</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;@update_row.json&quot;</span><span class="w"> </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/data/widgets/1
</pre></div>
</div>
<p>Note that since only the <code class="docutils literal notranslate"><span class="pre">count</span></code> field is provided in the PUT request body, that is the only column that will be
modified.</p>
</section>
<section id="updating-multiple-rows">
<h3>Updating Multiple Rows<a class="headerlink" href="#updating-multiple-rows" title="Link to this heading"></a></h3>
<p>Update multiple rows with a single HTTP request is possible using a <code class="docutils literal notranslate"><span class="pre">where</span></code> filter (for more details, see the section
<a class="reference internal" href="#where-stanzas">Where Stanzas</a> below), provided in the PUT request
body. For example, we could update the <code class="docutils literal notranslate"><span class="pre">count</span></code> column on all rows with a negative count to 0 using the following</p>
<p>update_rows.json</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="m">0</span>,
<span class="w">    </span><span class="s2">&quot;where&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;operator&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;&quot;</span>,
<span class="w">            </span><span class="s2">&quot;value&quot;</span>:<span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This update_rows.json would be used in a PUT request to the root <code class="docutils literal notranslate"><span class="pre">widgets</span></code> collection, as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;@update_rows.json&quot;</span><span class="w"> </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/data/widgets
</pre></div>
</div>
</section>
<section id="where-stanzas">
<h3>Where Stanzas<a class="headerlink" href="#where-stanzas" title="Link to this heading"></a></h3>
<p>In PgREST, <code class="docutils literal notranslate"><span class="pre">where</span></code> stanzas are used in various endpoints throughout the API to filter the collection of results (i.e.
rows) that an action (such as retrieving or updating) is applied to. The <code class="docutils literal notranslate"><span class="pre">where</span></code> stanza should be a JSON object with
each key being the name of a column on the table and the value under each key being a JSON object with two properties:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">operator</span></code> – a valid operator for the comparison. See the <a class="reference internal" href="#valid-operators">Valid Operators</a> table below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> – the value to compare the row’s column to (using the operator).</p></li>
</ul>
</div></blockquote>
<p>Naturally, the type (string, integer, boolean, etc.) of the <code class="docutils literal notranslate"><span class="pre">value</span></code> property should correspond to the type of the
column specified by the key. Note that multiple keys corresponding to the same column or different columns can be
included in a single <code class="docutils literal notranslate"><span class="pre">where</span></code> stanza. For example, the following where stanza would pick out rows whose <code class="docutils literal notranslate"><span class="pre">count</span></code>
was between <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">100</span></code> and whose <code class="docutils literal notranslate"><span class="pre">is_private</span></code> property was <code class="docutils literal notranslate"><span class="pre">true</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;where&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;operator&quot;</span>:<span class="w"> </span><span class="s2">&quot;&gt;&quot;</span>,
<span class="w">            </span><span class="s2">&quot;value&quot;</span>:<span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="o">}</span>,
<span class="w">        </span><span class="s2">&quot;count&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;operator&quot;</span>:<span class="w"> </span><span class="s2">&quot;&lt;&quot;</span>,
<span class="w">            </span><span class="s2">&quot;value&quot;</span>:<span class="w"> </span><span class="m">100</span>
<span class="w">        </span><span class="o">}</span>,
<span class="w">        </span><span class="s2">&quot;is_private&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s2">&quot;operator&quot;</span>:<span class="w"> </span><span class="s2">&quot;=&quot;</span>,
<span class="w">            </span><span class="s2">&quot;value&quot;</span>:<span class="w"> </span><span class="nb">true</span>
<span class="w">        </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="valid-operators">
<h3>Valid Operators<a class="headerlink" href="#valid-operators" title="Link to this heading"></a></h3>
<p>PgREST recognizes the following operators for use in <code class="docutils literal notranslate"><span class="pre">where</span></code> stanzas.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Operator</p></th>
<th class="head"><p>Postgres Equivalent</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>&lt;</p></td>
<td><p>&lt;</p></td>
<td><p>Less than</p></td>
</tr>
<tr class="row-odd"><td><p>&gt;</p></td>
<td><p>&gt;</p></td>
<td><p>Greater than</p></td>
</tr>
<tr class="row-even"><td><p>=</p></td>
<td><p>=</p></td>
<td><p>Equal</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<p><em>Todo… Full table coming soon</em></p>
</section>
<section id="retrieving-rows">
<h3>Retrieving Rows<a class="headerlink" href="#retrieving-rows" title="Link to this heading"></a></h3>
<p>To retrieve data from the <code class="docutils literal notranslate"><span class="pre">/data</span></code> API, make an HTTP GET request to the associated URL; an HTTP GET to
<code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data/{root_url}</span></code> will retrieve all rows on the associated table, while an HTTP GET to
<code class="docutils literal notranslate"><span class="pre">/v3/pgrest/data/{root_url}/{id}</span></code> will retrieve the individual row.</p>
<p>For example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>https://dev.tapis.io/v3/pgrest/data/init
</pre></div>
</div>
<p>retrieves all rows of the table “init”:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;_pkid&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">    </span><span class="s2">&quot;initial_table_id&quot;</span>:<span class="w"> </span><span class="m">1</span>,
<span class="w">    </span><span class="s2">&quot;col_one&quot;</span>:<span class="w"> </span><span class="s2">&quot;col 1 value&quot;</span>,
<span class="w">    </span><span class="s2">&quot;col_two&quot;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">    </span><span class="s2">&quot;col_three&quot;</span>:<span class="w"> </span><span class="m">8</span>,
<span class="w">    </span><span class="s2">&quot;col_four&quot;</span>:<span class="w"> </span>false,
<span class="w">    </span><span class="s2">&quot;col_five&quot;</span>:<span class="w"> </span>null
<span class="w">  </span><span class="o">}</span>,
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;_pkid&quot;</span>:<span class="w"> </span><span class="m">2</span>,
<span class="w">    </span><span class="s2">&quot;initial_table_id&quot;</span>:<span class="w"> </span><span class="m">2</span>,
<span class="w">    </span><span class="s2">&quot;col_one&quot;</span>:<span class="w"> </span><span class="s2">&quot;val&quot;</span>,
<span class="w">    </span><span class="s2">&quot;col_two&quot;</span>:<span class="w"> </span><span class="m">5</span>,
<span class="w">    </span><span class="s2">&quot;col_three&quot;</span>:<span class="w"> </span><span class="m">9</span>,
<span class="w">    </span><span class="s2">&quot;col_four&quot;</span>:<span class="w"> </span>true,
<span class="w">    </span><span class="s2">&quot;col_five&quot;</span>:<span class="w"> </span><span class="s2">&quot;hi there&quot;</span>
<span class="w">  </span><span class="o">}</span>,
<span class="w">  </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;_pkid&quot;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">    </span><span class="s2">&quot;initial_table_id&quot;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">    </span><span class="s2">&quot;col_one&quot;</span>:<span class="w"> </span><span class="s2">&quot;value&quot;</span>,
<span class="w">    </span><span class="s2">&quot;col_two&quot;</span>:<span class="w"> </span><span class="m">7</span>,
<span class="w">    </span><span class="s2">&quot;col_three&quot;</span>:<span class="w"> </span><span class="m">9</span>,
<span class="w">    </span><span class="s2">&quot;col_four&quot;</span>:<span class="w"> </span>true,
<span class="w">    </span><span class="s2">&quot;col_five&quot;</span>:<span class="w"> </span><span class="s2">&quot;hi there again&quot;</span>
<span class="w">  </span><span class="o">}</span>
<span class="o">]</span>
</pre></div>
</div>
<p>while the following curl:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>https://dev.tapis.io/v3/pgrest/data/init/3
</pre></div>
</div>
<p>retrieves just the row with id “3”:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;_pkid&quot;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">  </span><span class="s2">&quot;initial_table_id&quot;</span>:<span class="w"> </span><span class="m">3</span>,
<span class="w">  </span><span class="s2">&quot;col_one&quot;</span>:<span class="w"> </span><span class="s2">&quot;value&quot;</span>,
<span class="w">  </span><span class="s2">&quot;col_two&quot;</span>:<span class="w"> </span><span class="m">7</span>,
<span class="w">  </span><span class="s2">&quot;col_three&quot;</span>:<span class="w"> </span><span class="m">9</span>,
<span class="w">  </span><span class="s2">&quot;col_four&quot;</span>:<span class="w"> </span>true,
<span class="w">  </span><span class="s2">&quot;col_five&quot;</span>:<span class="w"> </span><span class="s2">&quot;hi there again&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="retrieving-rows-with-search-parameters">
<h3>Retrieving rows with search parameters<a class="headerlink" href="#retrieving-rows-with-search-parameters" title="Link to this heading"></a></h3>
<p>PgREST allows users to retrieve table rows from either the <code class="docutils literal notranslate"><span class="pre">/data</span></code> endpoint or the <code class="docutils literal notranslate"><span class="pre">/view</span></code> endpoint
using search parameters follow the Tapis V3 search specification. All search operations available and
examples are detailed below.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Support of retrieving rows with search parameters is available in version 1.1.0. Previous implementation
disregarded due to being out of date with Tapis V3 search specifications.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Two additional query parameters are limit and offset. Used like <code class="docutils literal notranslate"><span class="pre">?limit=20</span></code> or/and <code class="docutils literal notranslate"><span class="pre">?offset=5</span></code>. This
caps the amount of results you get back or gives you results past a set number, respectively.</p>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Operator</p></td>
<td><p>Postgres Equivalent</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>.eq</p></td>
<td><p>=</p></td>
<td><p>Equal</p></td>
</tr>
<tr class="row-odd"><td><p>.neq</p></td>
<td><p>!=</p></td>
<td><p>Not equal</p></td>
</tr>
<tr class="row-even"><td><p>.lt</p></td>
<td><p>&lt;</p></td>
<td><p>Less than</p></td>
</tr>
<tr class="row-odd"><td><p>.lte</p></td>
<td><p>&lt;=</p></td>
<td><p>Less than or equal</p></td>
</tr>
<tr class="row-even"><td><p>.gt</p></td>
<td><p>&gt;</p></td>
<td><p>Greater than</p></td>
</tr>
<tr class="row-odd"><td><p>.gte</p></td>
<td><p>&gt;=</p></td>
<td><p>Greater than or equal</p></td>
</tr>
<tr class="row-even"><td><p>.in</p></td>
<td><p>IN</p></td>
<td><p>In set of</p></td>
</tr>
<tr class="row-odd"><td><p>.nin</p></td>
<td><p>NOT IN</p></td>
<td><p>Not in set of</p></td>
</tr>
<tr class="row-even"><td><p>.like</p></td>
<td><p>LIKE</p></td>
<td><p>Like value</p></td>
</tr>
<tr class="row-odd"><td><p>.nlike</p></td>
<td><p>NOT LIKE</p></td>
<td><p>Not like value</p></td>
</tr>
<tr class="row-even"><td><p>.between</p></td>
<td><p>BETWEEN</p></td>
<td><p>Between set</p></td>
</tr>
<tr class="row-odd"><td><p>.nbetween</p></td>
<td><p>NOT BETWEEN</p></td>
<td><p>Not between set</p></td>
</tr>
<tr class="row-even"><td><p>.null</p></td>
<td><p>IS NULL</p></td>
<td><p>Set to TRUE/FALSE</p></td>
</tr>
</tbody>
</table>
<p>These operators are used in an endpoint’s query parameters. For example if I had a table with root_url
<code class="docutils literal notranslate"><span class="pre">my_table</span></code> and I wanted to get all rows with column <code class="docutils literal notranslate"><span class="pre">age</span></code> greater than <code class="docutils literal notranslate"><span class="pre">15</span></code> I could do the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://tapis.io/v3/pgrest/data/my_table?age.gt<span class="o">=</span><span class="m">15</span>
</pre></div>
</div>
<p>Another example using .between this time would be finding all rows with column <code class="docutils literal notranslate"><span class="pre">age</span></code> between <code class="docutils literal notranslate"><span class="pre">18-30</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://tapis.io/v3/pgrest/data/my_table?age.between<span class="o">=</span><span class="m">18</span>,30
</pre></div>
</div>
<p>If you only wanted all rows with column <code class="docutils literal notranslate"><span class="pre">age</span></code> that match <code class="docutils literal notranslate"><span class="pre">20</span></code>, <code class="docutils literal notranslate"><span class="pre">30</span></code>, or <code class="docutils literal notranslate"><span class="pre">40</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://tapis.io/v3/pgrest/data/my_table?age.in<span class="o">=</span><span class="m">20</span>,30,40
</pre></div>
</div>
</section>
</section>
<section id="views-manage-api">
<h2>Views Manage API<a class="headerlink" href="#views-manage-api" title="Link to this heading"></a></h2>
<p>Views allow admins to create postgres views to cordone off data from users and give users exactly what they need.
These views allow for permission_rules which cross reference a users roles, if a user has all roles in the
permission_rules they have access to view the view.</p>
<p>Admins are able to create views with a post to the <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage/views</span></code> endpoint. A get to <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage/views</span></code>
returns information regarding the views.</p>
<section id="view-definition-rules">
<h3>View Definition Rules<a class="headerlink" href="#view-definition-rules" title="Link to this heading"></a></h3>
<p>A post to the <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage/views</span></code> endpoint to create a view expects a json formatted view definition. Each view
definition can have the following rules.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">view_name</span></code> - <strong>required</strong></p>
<ul class="simple">
<li><p>The name of the view in question.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">select_query</span></code> - <strong>required</strong></p>
<ul class="simple">
<li><p>Query to select from the table specified with from_table</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_table</span></code> - <strong>required</strong></p>
<ul class="simple">
<li><p>Table to read data from</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">root_url</span></code></p>
<ul class="simple">
<li><p>The root_url for PgRESTs /views endpoint.</p></li>
<li><p>Ex: root_url “view25” would be accessible via “<a class="reference external" href="http://pgrestURL/views/table25">http://pgrestURL/views/table25</a>”.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">where_query</span></code></p>
<ul class="simple">
<li><p>Optional field that allows you to specify a postgres where clause for the view</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">comments</span></code></p>
<ul class="simple">
<li><p>Field to allow for better readability of view json. Table comments are saved and outputted on <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage/views/</span></code> endpoints.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">permission_rules</span></code></p>
<ul class="simple">
<li><p>List of roles required to view this view.</p></li>
<li><p>If nothing is given, view is open to all.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">raw_sql</span></code> - <strong>admins only</strong></p>
<ul>
<li><p>To allow for better use of postgres’s facilities there is a raw_sql view creation parameter.</p></li>
<li><p>To use this parameter you must be an admin (talk to service admins)</p></li>
<li><p>When using this paramter, select_query, where_query, and from_table are no longer allowed, other parameters are fine.</p></li>
<li><p>The query follows <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">OR</span> <span class="pre">REPLACE</span> <span class="pre">VIEW</span> <span class="pre">{tenant}.{view_name}</span> <span class="pre">{raw_sql}</span></code> format.</p></li>
<li><p>Example data body:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s2">&quot;view_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;my_new_test_view&quot;</span>,
<span class="w"> </span><span class="s2">&quot;raw_sql&quot;</span>:<span class="w"> </span><span class="s2">&quot;AS SELECT * FROM tenant.my_table WHERE col_name &gt;= 600;&quot;</span>,
<span class="w"> </span><span class="s2">&quot;comments&quot;</span>:<span class="w"> </span><span class="s2">&quot;An example of creating my_new_test_view.&quot;</span><span class="o">}</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">materialized_view_raw_sql</span></code> - <strong>admins only</strong></p>
<ul>
<li><p>To allow for better use of postgres’s facilities there is a materialized_view_raw_sql view creation parameter.</p></li>
<li><p>To use this parameter you must be an admin (talk to service admins)</p></li>
<li><p>When using this paramter, select_query, raw_sql, where_query, and from_table are no longer allowed, other parameters are fine.</p></li>
<li><p>The query follows <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">MATERIALIZED</span> <span class="pre">VIEW</span> <span class="pre">{tenant}.{view_name}</span> <span class="pre">{materialized_view_raw_sql}</span></code> format.</p></li>
<li><p>Refresh the materialized view data by GET <code class="docutils literal notranslate"><span class="pre">https://tenant.tapis.io/v3/pgrest/manage/views/{view_id}/refresh</span></code>. Detailed later in these docs.</p></li>
<li><p>Data is only updated at creation and during manual refreshes from users.</p></li>
<li><p>Example data body:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span><span class="s2">&quot;view_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;my_new_materialized_test_view&quot;</span>,
<span class="w"> </span><span class="s2">&quot;materialized_view_raw_sql&quot;</span>:<span class="w"> </span><span class="s2">&quot;AS SELECT * FROM tenant.my_table WHERE col_name &gt;= 600;&quot;</span>,
<span class="w"> </span><span class="s2">&quot;comments&quot;</span>:<span class="w"> </span><span class="s2">&quot;An example of creating my_new_materialized_test_view.&quot;</span><span class="o">}</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="view-creation-example">
<h3>View Creation Example<a class="headerlink" href="#view-creation-example" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># new_view.json</span>
<span class="o">{</span><span class="s1">&#39;view_name&#39;</span>:<span class="w"> </span><span class="s1">&#39;test_view&#39;</span>,
<span class="w"> </span><span class="s1">&#39;root_url&#39;</span>:<span class="w"> </span><span class="s1">&#39;just_a_cool_url&#39;</span>,
<span class="w"> </span><span class="s1">&#39;select_query&#39;</span>:<span class="w"> </span><span class="s1">&#39;*&#39;</span>,
<span class="w"> </span><span class="s1">&#39;from_table&#39;</span>:<span class="w"> </span><span class="s1">&#39;initial_table_2&#39;</span>,
<span class="w"> </span><span class="s1">&#39;where_query&#39;</span>:<span class="w"> </span><span class="s1">&#39;col_one &gt;= 90&#39;</span>,
<span class="w"> </span><span class="s1">&#39;permission_rules&#39;</span>:<span class="w"> </span><span class="o">[</span><span class="s1">&#39;lab_6_admin&#39;</span>,<span class="w"> </span><span class="s1">&#39;cii_rep&#39;</span><span class="o">]</span>,
<span class="w"> </span><span class="s1">&#39;comments&#39;</span>:<span class="w"> </span><span class="s1">&#39;This is a cool test_view to view all of</span>
<span class="s1">              initial_table_2. Only users with the</span>
<span class="s1">              lab_6_admin and cii_rep role can view this.&#39;</span><span class="o">}</span>
</pre></div>
</div>
<p>The following code block would then be able to create the new view.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s2">&quot;@new_view.json&quot;</span><span class="w"> </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/manage/views
</pre></div>
</div>
<p>If you then wanted to get information about the view, but not the result of the view itself, you can make a call to the
<code class="docutils literal notranslate"><span class="pre">/v3/pgrest/manage/views/just_a_cool_url</span></code> endpoint.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/manage/views/just_a_cool_url
</pre></div>
</div>
</section>
<section id="materialized-view-refresh-example">
<h3>Materialized View Refresh Example<a class="headerlink" href="#materialized-view-refresh-example" title="Link to this heading"></a></h3>
<p>If you had earlier created a view using the <code class="docutils literal notranslate"><span class="pre">materialized_view_raw_sql</span></code> attribute, you’d have a materialized view that you
can refresh the data of manually. Data for materialized views is updated at creation, and at refreshes, there is not other
automatic refreshing of the data.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/manage/views/<span class="o">{</span>view_id<span class="o">}</span>/refresh
</pre></div>
</div>
</section>
</section>
<section id="views-user-api">
<h2>Views User API<a class="headerlink" href="#views-user-api" title="Link to this heading"></a></h2>
<p>Users have no way to change views or to modify anything dealing with them, but they are able to get views that they have
sufficient permissions to view. The <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/views/{view_id}</span></code> requires the user to have at least a PGREST_USER role,
this is to force all users to be in some way identified or managed. The PGREST_USER role grants no permissions except the
permission to call a get on the <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/views/{view_id}</span></code> endpoint. This means that admins can assume PGREST_USER users
can only view <cite>views</cite> in which the user satisfies the permissions declared in a <cite>views</cite> <code class="docutils literal notranslate"><span class="pre">permission_rules</span></code>. This gives
admins fine-tuned controls on postgres data by using solely views.</p>
<p>Users can make a get to <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/views/{view_id}</span></code> with the following curl.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/views/just_a_cool_url
</pre></div>
</div>
<section id="id1">
<h3>Retrieving rows with search parameters<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>PgREST allows users to retrieve table rows from either the <code class="docutils literal notranslate"><span class="pre">/data</span></code> endpoint or the <code class="docutils literal notranslate"><span class="pre">/view</span></code> endpoint
using search parameters follow the Tapis V3 search specification. All search operations available and
examples are detailed below.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Support of retrieving rows with search parameters is available in version 1.1.0. Previous implementation
disregarded due to being out of date with Tapis V3 search specifications.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Two additional query parameters are limit and offset. Used like <code class="docutils literal notranslate"><span class="pre">?limit=20</span></code> or/and <code class="docutils literal notranslate"><span class="pre">?offset=5</span></code>. This
caps the amount of results you get back or gives you results past a set number, respectively.</p>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>Operator</p></td>
<td><p>Postgres Equivalent</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>.eq</p></td>
<td><p>=</p></td>
<td><p>Equal</p></td>
</tr>
<tr class="row-odd"><td><p>.neq</p></td>
<td><p>!=</p></td>
<td><p>Not equal</p></td>
</tr>
<tr class="row-even"><td><p>.lt</p></td>
<td><p>&lt;</p></td>
<td><p>Less than</p></td>
</tr>
<tr class="row-odd"><td><p>.lte</p></td>
<td><p>&lt;=</p></td>
<td><p>Less than or equal</p></td>
</tr>
<tr class="row-even"><td><p>.gt</p></td>
<td><p>&gt;</p></td>
<td><p>Greater than</p></td>
</tr>
<tr class="row-odd"><td><p>.gte</p></td>
<td><p>&gt;=</p></td>
<td><p>Greater than or equal</p></td>
</tr>
<tr class="row-even"><td><p>.in</p></td>
<td><p>IN</p></td>
<td><p>In set of</p></td>
</tr>
<tr class="row-odd"><td><p>.nin</p></td>
<td><p>NOT IN</p></td>
<td><p>Not in set of</p></td>
</tr>
<tr class="row-even"><td><p>.like</p></td>
<td><p>LIKE</p></td>
<td><p>Like value</p></td>
</tr>
<tr class="row-odd"><td><p>.nlike</p></td>
<td><p>NOT LIKE</p></td>
<td><p>Not like value</p></td>
</tr>
<tr class="row-even"><td><p>.between</p></td>
<td><p>BETWEEN</p></td>
<td><p>Between set</p></td>
</tr>
<tr class="row-odd"><td><p>.nbetween</p></td>
<td><p>NOT BETWEEN</p></td>
<td><p>Not between set</p></td>
</tr>
<tr class="row-even"><td><p>.null</p></td>
<td><p>IS NULL</p></td>
<td><p>Set to TRUE/FALSE</p></td>
</tr>
</tbody>
</table>
<p>These operators are used in an endpoint’s query parameters. For example if I had a view with root_url
<code class="docutils literal notranslate"><span class="pre">my_view</span></code> and I wanted to get all rows with column <code class="docutils literal notranslate"><span class="pre">age</span></code> greater than <code class="docutils literal notranslate"><span class="pre">15</span></code> I could do the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://tapis.io/v3/pgrest/views/my_view?age.gt<span class="o">=</span><span class="m">15</span>
</pre></div>
</div>
<p>Another example using .between this time would be finding all rows with column <code class="docutils literal notranslate"><span class="pre">age</span></code> between <code class="docutils literal notranslate"><span class="pre">18-30</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://tapis.io/v3/pgrest/views/my_view?age.between<span class="o">=</span><span class="m">18</span>,30
</pre></div>
</div>
<p>If you only wanted all rows with column <code class="docutils literal notranslate"><span class="pre">age</span></code> that match <code class="docutils literal notranslate"><span class="pre">20</span></code>, <code class="docutils literal notranslate"><span class="pre">30</span></code>, or <code class="docutils literal notranslate"><span class="pre">40</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://tapis.io/v3/pgrest/views/my_view?age.in<span class="o">=</span><span class="m">20</span>,30,40
</pre></div>
</div>
</section>
</section>
<section id="role-manage-api">
<h2>Role Manage API<a class="headerlink" href="#role-manage-api" title="Link to this heading"></a></h2>
<p>Role management is solely allowed for users in the PGREST_ROLE_ADMIN role, or PGREST_ADMIN. These endpoints allow users to
create, grant, and revoke SK roles to users to match <cite>view</cite> <code class="docutils literal notranslate"><span class="pre">permission_rules</span></code>. Modifiable roles all must start with
<code class="docutils literal notranslate"><span class="pre">PGREST_</span></code>, this ensures users can’t change roles that might matter to other services. Along with that, users cannot manage
the <code class="docutils literal notranslate"><span class="pre">PGREST_ADMIN</span></code>, <code class="docutils literal notranslate"><span class="pre">PGREST_ROLE_ADMIN</span></code>, <code class="docutils literal notranslate"><span class="pre">PGREST_WRITE</span></code>, or <code class="docutils literal notranslate"><span class="pre">PGREST_READ</span></code> roles. This might be changed, but for now,
contact an admin to be given these roles. Note, users can grant or revoke the <code class="docutils literal notranslate"><span class="pre">PGREST_USER</span></code> role, so that role_admins can
manage who can see views without unnecessary intervention.</p>
<p>Users have no access to these endpoints or anything regarding roles.</p>
<section id="role-creation">
<h3>Role Creation<a class="headerlink" href="#role-creation" title="Link to this heading"></a></h3>
<p>To create a new role users make a post to <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/roles/</span></code> with a body such as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># new_role.json</span>
<span class="o">{</span><span class="s2">&quot;role_name&quot;</span>:<span class="w"> </span><span class="s2">&quot;PGREST_My_New_Role&quot;</span>,<span class="w"> </span><span class="s2">&quot;description&quot;</span>:<span class="w"> </span><span class="s2">&quot;A new role!&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>The post would then be as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s2">&quot;@new_role.json&quot;</span><span class="w"> </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/roles
</pre></div>
</div>
<p>This would result in the creation of the <code class="docutils literal notranslate"><span class="pre">PGREST_My_New_Role</span></code> role.</p>
<section id="role-creation-definition">
<h4>Role Creation Definition<a class="headerlink" href="#role-creation-definition" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">role_name</span></code> - <strong>required</strong></p>
<ul>
<li><p>Name of the role to create, must start with <code class="docutils literal notranslate"><span class="pre">PGREST_</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code> - <strong>required</strong></p>
<ul>
<li><p>A description of the role to be used for future reference in SK.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="role-management">
<h3>Role Management<a class="headerlink" href="#role-management" title="Link to this heading"></a></h3>
<p>To grant or revoke a role to a specific username, users can make a post to <code class="docutils literal notranslate"><span class="pre">/v3/pgrest/roles/{role_name}</span></code> with a body such as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># grant_role.json</span>
<span class="o">{</span><span class="s2">&quot;method&quot;</span>:<span class="w"> </span><span class="s2">&quot;grant&quot;</span>,<span class="w"> </span><span class="s2">&quot;username&quot;</span>:<span class="w"> </span><span class="s2">&quot;user3234&quot;</span><span class="o">}</span>
</pre></div>
</div>
<p>The post would then be as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>curl<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;tapis-v2-token: </span><span class="nv">$TOKEN</span><span class="s2">&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s2">&quot;@grant_role.json&quot;</span><span class="w"> </span>https://&lt;tenant&gt;.tapis.io/v3/pgrest/roles/PGREST_My_New_Role
</pre></div>
</div>
<p>This would result in the user, <code class="docutils literal notranslate"><span class="pre">user3234</span></code> being granted the role, <code class="docutils literal notranslate"><span class="pre">PGREST_My_New_Role</span></code>.</p>
<section id="role-management-parameters">
<h4>Role Management Parameters<a class="headerlink" href="#role-management-parameters" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">method</span></code> - <strong>required</strong></p>
<ul>
<li><p>String of either “grant” or “revoke”, specifying whether to revoke or grant the role to a user.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code> - <strong>required</strong></p>
<ul>
<li><p>Username to grant role to, or to revoke role from.</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="stored-procedures">
<h2>Stored Procedures<a class="headerlink" href="#stored-procedures" title="Link to this heading"></a></h2>
<p><em>Coming soon</em></p>
</section>
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>GET</p></th>
<th class="head"><p>POST</p></th>
<th class="head"><p>PUT</p></th>
<th class="head"><p>DEL</p></th>
<th class="head"><p>Endpoint</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>X</p></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td><p>/v3/pgrest/manage/tables</p></td>
<td><p>Get/Create tables for the tenant.</p></td>
</tr>
<tr class="row-odd"><td><p>X</p></td>
<td></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>/v3/pgrest/manage/tables/{table_id}</p></td>
<td><p>Get/Update/Delete a specified table.</p></td>
</tr>
<tr class="row-even"><td><p>X</p></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td></td>
<td><p>/v3/pgrest/data/{table_id}</p></td>
<td><p>Get/Create/Update rows for a specified table.</p></td>
</tr>
<tr class="row-odd"><td><p>X</p></td>
<td></td>
<td><p>X</p></td>
<td><p>X</p></td>
<td><p>/v3/pgrest/data/{table_id}/{row_id}</p></td>
<td><p>Get/Update/Delete specific row for a specified table.</p></td>
</tr>
<tr class="row-even"><td><p>X</p></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td><p>/v3/pgrest/manage/views</p></td>
<td><p>Get/Create view for the tenant.</p></td>
</tr>
<tr class="row-odd"><td><p>X</p></td>
<td></td>
<td></td>
<td><p>X</p></td>
<td><p>/v3/pgrest/manage/views/{view_id}</p></td>
<td><p>Get/Delete view specified.</p></td>
</tr>
<tr class="row-even"><td><p>X</p></td>
<td></td>
<td></td>
<td></td>
<td><p>/v3/pgrest/views/{view_id}</p></td>
<td><p>Get results from view specified.</p></td>
</tr>
<tr class="row-odd"><td><p>X</p></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td><p>/v3/pgrest/manage/roles</p></td>
<td><p>Get/Create roles in SK for the tenant.</p></td>
</tr>
<tr class="row-even"><td><p>X</p></td>
<td><p>X</p></td>
<td></td>
<td></td>
<td><p>/v3/pgrest/manage/roles/{role_name}</p></td>
<td><p>Get/Manage role specified.</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, ICICLE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>